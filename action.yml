name: NuGet Build & Push to GitHub

inputs:
  pushBuild:
    required: true
    type: boolean
  version:
    required: true
    type: string
  isRcBuild:
    required: false
    type: boolean
    default: false
  csprojPath:
    required: true
    type: stringy
  dotNetVersion:
    required: true
    type: string
    default: '8.x'
  ghPAT:
    required: true
    type: string
    
runs:
  using: "composite"
  steps:    
  
    - name: Checkout 
      uses: actions/checkout@v3.3.0
      
    - name: Setup dotnet ${{ inputs.dotNetVersion }}
      uses: actions/setup-dotnet@v3
      with:
        dotnet-version: ${{ inputs.dotNetVersion }}
      
    - name: Pack Stable
      if: ${{ !inputs.isRcBuild }}
      run: dotnet pack ${{ inputs.csprojPath }} -c Release -p:PackageVersion=${{ inputs.version }}
      
    - name: Pack RC
      if: ${{ inputs.isRcBuild }}
      run: dotnet pack ${{ inputs.csprojPath }} -c Release -p:PackageVersion=${{ inputs.version }}-rc
      
    - name: Prep packages
      if: ${{ inputs.pushBuild }}
      run: dotnet nuget add source --username thenightangel17 --password ${{ inputs.ghPAT }} --store-password-in-clear-text --name github "https://nuget.pkg.github.com/mlx-development/index.json"
      
    - name: Publish to GitHub packages
      if: ${{ inputs.pushBuild }}
      run: dotnet nuget push **/*.nupkg --api-key ${{ inputs.ghPAT }} --source "github"
